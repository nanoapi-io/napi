import { useContext, useEffect, useState } from "react";
import { useLocation, useNavigate } from "react-router";
import { StoreContext } from "../contexts/StoreContext";
import WorkspaceMenu from "./WorkspaceMenu";

export default function AppSidebar() {
  const { state } = useContext(StoreContext);
  const location = useLocation();
  const navigate = useNavigate();

  const [workspace, setWorkspace] = useState({ name: "Default", users: [] });

  useEffect(() => {
    const userData = state.user;
    console.log("userData", userData);
    if (!userData) {
      return;
    }

    console.log("activeWorkspace", state.activeWorkspace);

    let activeWorkspace;
    if (!state.activeWorkspace) {
      if (!localStorage.getItem("activeWorkspace")) {
        return;
      }
      activeWorkspace = parseInt(localStorage.getItem("activeWorkspace") as string);
    } else {
      activeWorkspace = state.activeWorkspace;
    }

    const workspaces = userData.workspaces;
    const found = workspaces.find(
      (ws: any) => ws.id === activeWorkspace
    );
    if (!found) {
      return;
    }
    console.log("found", found);
    setWorkspace(found);
  }, [state.activeWorkspace, state.user]);

  return (
    <div className="bg-secondaryBackground-light dark:bg-secondaryBackground-dark w-80 px-4 py-2 rounded-xl flex flex-col">
      {/* Header */}
      <div className="flex justify-between">
        <div className="flex gap-x-1">
          <img className="w-12 h-12 rounded-full" src="/logo.png" alt="Logo" />
          <h1 className="text-2xl font-bold my-auto">NanoAPI</h1>
        </div>
        <button className="text-text-gray">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M14.7071 7.70711C15.0976 7.31658 15.0976 6.68342 14.7071 6.29289C14.3166 5.90237 13.6834 5.90237 13.2929 6.29289L10.2929 9.29289C9.90237 9.68342 9.90237 10.3166 10.2929 10.7071L13.2929 13.7071C13.6834 14.0976 14.3166 14.0976 14.7071 13.7071C15.0976 13.3166 15.0976 12.6834 14.7071 12.2929L12.4142 10L14.7071 7.70711Z" fill="currentColor"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M3 20H17C18.6569 20 20 18.6569 20 17V3C20 1.34315 18.6569 0 17 0H3C1.34315 0 0 1.34315 0 3V17C0 18.6569 1.34315 20 3 20ZM3 2C2.44772 2 2 2.44772 2 3V17C2 17.5523 2.44772 18 3 18H6V2H3ZM8 2V18H17C17.5523 18 18 17.5523 18 17V3C18 2.44772 17.5523 2 17 2H8Z" fill="currentColor"/>
          </svg>
        </button>
      </div>

      {/* Workspace info */}
      <div className="px-4 py-4 bg-[#212047] rounded-lg mt-4 border-[1px] border-[#35345B]">
        <h2 className="font-bold">{workspace.name} Workspace</h2>
        <div className="flex gap-x-2 border-b-[1px] border-[#2B2A51] pt-2 pb-3">
          {/* IMG */}
          <div className="flex">
            <img className="w-6 h-6 rounded-full border-[1px] border-foreground-light dark:border-foreground-dark" src="https://randomuser.me/api/portraits/men/75.jpg" alt="Profile" />
            <img className="w-6 h-6 ml-[-6px] rounded-full border-[1px] border-foreground-light dark:border-foreground-dark" src="https://randomuser.me/api/portraits/men/75.jpg" alt="Profile" />
            <img className="w-6 h-6 ml-[-6px] rounded-full border-[1px] border-foreground-light dark:border-foreground-dark" src="https://randomuser.me/api/portraits/men/75.jpg" alt="Profile" />
          </div>
          <p className="text-text-lightInfo dark:text-text-darkInfo text-sm">{workspace.users.length} {workspace.users.length === 1 ? "member" : "members"}</p>
        </div>

        {/* Invite teammates */}
        <button className="flex text-text-gray w-full mt-2 p-2 gap-x-2 rounded-lg hover:bg-hover-light dark:hover:bg-hover-dark transition-all">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M6.35861 12.7691C4.92484 11.6727 4 9.94433 4 8C4 4.68629 6.68629 2 10 2C13.3137 2 16 4.68629 16 8C16 9.94433 15.0752 11.6727 13.6414 12.7691C14.479 13.1397 15.2595 13.6379 15.9535 14.25C16.3677 14.6153 16.4073 15.2473 16.0419 15.6615C15.6766 16.0756 15.0447 16.1152 14.6305 15.7499C13.6202 14.8587 12.3741 14.278 11.0419 14.0775C10.7144 14.0282 10.3851 14.0024 10.0564 13.9997L10 14L9.94361 13.9997C8.97355 14.0076 8.01151 14.217 7.12002 14.6194C5.89211 15.1737 4.85024 16.0705 4.11943 17.2023C3.38862 18.3341 2.99993 19.6527 3 20.9999C3.00003 21.5522 2.55234 21.9999 2.00005 22C1.44777 22 1.00003 21.5523 1 21C0.999905 19.2679 1.49965 17.5725 2.43926 16.1174C3.37888 14.6622 4.71843 13.5092 6.29717 12.7965L6.35861 12.7691ZM6 8C6 5.79086 7.79086 4 10 4C12.2091 4 14 5.79086 14 8C14 10.1917 12.2374 11.9716 10.0524 11.9997C10.0175 11.9995 9.98255 11.9995 9.94766 11.9997C7.76264 11.9716 6 10.1917 6 8Z" fill="currentColor"/>
            <path d="M19 15C19.5523 15 20 15.4477 20 16V18H22C22.5523 18 23 18.4477 23 19C23 19.5523 22.5523 20 22 20H20V22C20 22.5523 19.5523 23 19 23C18.4477 23 18 22.5523 18 22V20H16C15.4477 20 15 19.5523 15 19C15 18.4477 15.4477 18 16 18H18V16C18 15.4477 18.4477 15 19 15Z" fill="currentColor"/>
          </svg>
          <p className="text-md">Invite teammates</p>

        </button>
      </div>

      {/* Navigation */}
      <div className="grow flex flex-col mt-8 gap-y-2">
        <button 
          onClick={() => navigate("/projects")}
          className={`flex gap-x-2 p-2 rounded-lg hover:bg-hover-light dark:hover:bg-hover-dark transition-all ${
          location.pathname.includes("/projects") ? "bg-foreground-light dark:bg-foreground-dark text-text-lightHighlight dark:text-text-darkHighlight" : "text-text-gray"
        }`}>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M8.38965 4.11724C8.24203 4.03862 8.07705 3.99829 7.9098 3.99993C7.90654 3.99996 7.90327 3.99997 7.9 3.99997H4C3.73478 3.99997 3.48043 4.10533 3.29289 4.29287C3.10536 4.4804 3 4.73476 3 4.99997V18C3 18.2652 3.10536 18.5195 3.29289 18.7071C3.48043 18.8946 3.73478 19 4 19H18.45C18.4523 19 18.4545 19 18.4568 19C18.6796 19.0015 18.8966 18.9285 19.0732 18.7926C19.2496 18.6569 19.3757 18.4663 19.4315 18.2508C19.4316 18.2505 19.4317 18.2503 19.4317 18.25L20.9718 12.25C21.0099 12.1021 21.0137 11.9474 20.9829 11.7977C20.952 11.6481 20.8872 11.5076 20.7935 11.3869C20.6999 11.2662 20.5798 11.1686 20.4426 11.1015C20.3053 11.0344 20.1545 10.9997 20.0018 11L20 11H9.25356C9.07568 11.0058 8.90251 11.059 8.75197 11.1542C8.59872 11.2511 8.4747 11.3878 8.39316 11.5497C8.39153 11.5529 8.38988 11.5562 8.38822 11.5594L6.88822 14.4594C6.63449 14.9499 6.03113 15.1419 5.54058 14.8882C5.05003 14.6345 4.85805 14.0311 5.11178 13.5406L6.60952 10.6449C6.85417 10.1615 7.2252 9.75324 7.68325 9.46366C8.14299 9.17303 8.67308 9.01284 9.21684 9.00024C9.22456 9.00006 9.23228 8.99997 9.24 8.99997H19V7.99997C19 7.73476 18.8946 7.4804 18.7071 7.29287C18.5196 7.10533 18.2652 6.99997 18 6.99997H12.07V5.99812L12.0698 6.99997C11.5732 6.99989 11.0843 6.8765 10.6471 6.64088C10.2117 6.40625 9.84114 6.06764 9.56829 5.65521L8.76115 4.45945C8.75902 4.45629 8.7569 4.45311 8.7548 4.44993C8.66282 4.31024 8.53728 4.19585 8.38965 4.11724ZM12.07 4.99997C12.0701 4.99997 12.0701 4.99997 12.0702 4.99997H18C18.7957 4.99997 19.5587 5.31604 20.1213 5.87865C20.6839 6.44126 21 7.20432 21 7.99997V9.17031C21.1091 9.20874 21.2162 9.25355 21.3207 9.3046C21.7325 9.50582 22.0926 9.79871 22.3736 10.1608C22.6546 10.5228 22.8489 10.9445 22.9415 11.3933C23.0342 11.8421 23.0228 12.3062 22.9082 12.75L21.3686 18.7486L21.3683 18.75C21.2011 19.3973 20.8226 19.9703 20.2926 20.3779C19.7637 20.7848 19.1143 21.0036 18.447 21H4C3.20435 21 2.44129 20.6839 1.87868 20.1213C1.31607 19.5587 1 18.7956 1 18V4.99997C1 4.20432 1.31607 3.44126 1.87868 2.87865C2.44129 2.31604 3.20435 1.99997 4 1.99997H7.8956C8.39548 1.99597 8.88846 2.11695 9.32975 2.35195C9.77076 2.58681 10.1461 2.92809 10.4217 3.34477L11.2288 4.5405C11.231 4.54365 11.2331 4.5468 11.2352 4.54997C11.3262 4.68824 11.4502 4.80173 11.5959 4.88028C11.7416 4.95879 11.9045 4.99992 12.07 4.99997Z" fill="currentColor"/>
          </svg>
          <p className="text-md">My projects</p>
        </button>
        <button className={`flex gap-x-2 p-2 rounded-lg hover:bg-hover-light dark:hover:bg-hover-dark transition-all ${
          location.pathname.includes("/notifications") ? "bg-foreground-light dark:bg-foreground-dark text-text-lightHighlight dark:text-text-darkHighlight" : "text-text-gray"
        }`}>
          <svg width="20" height="22" viewBox="0 0 20 22" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M19.5635 15.1737L19.5664 15.1758C19.9249 15.4221 20.0835 15.8725 19.9572 16.2898C19.8295 16.7115 19.4407 17 19.0001 17H1.00008C0.559411 17 0.170684 16.7115 0.0429858 16.2898C-0.0833578 15.8725 0.075285 15.4221 0.433776 15.1758L0.436625 15.1737C0.444325 15.168 0.462178 15.1544 0.4888 15.1322C0.542016 15.0878 0.6304 15.0091 0.742875 14.8904C0.967304 14.6535 1.29039 14.2544 1.62218 13.6461C2.28301 12.4346 3.00008 10.3527 3.00008 7C3.00008 5.14348 3.73758 3.36301 5.05033 2.05025C6.36308 0.737498 8.14356 0 10.0001 0C11.8566 0 13.6371 0.737498 14.9498 2.05025C16.2626 3.36301 17.0001 5.14348 17.0001 7C17.0001 10.3527 17.7171 12.4346 18.378 13.6461C18.7098 14.2544 19.0329 14.6535 19.2573 14.8904C19.3698 15.0091 19.4581 15.0878 19.5114 15.1322C19.538 15.1544 19.5558 15.168 19.5635 15.1737ZM6.46454 3.46447C7.40223 2.52678 8.674 2 10.0001 2C11.3262 2 12.5979 2.52678 13.5356 3.46447C14.4733 4.40215 15.0001 5.67392 15.0001 7C15.0001 10.6473 15.783 13.0654 16.6222 14.6039C16.6983 14.7434 16.7747 14.8753 16.8508 15H3.1494C3.22549 14.8753 3.30188 14.7434 3.37797 14.6039C4.21715 13.0654 5.00008 10.6473 5.00008 7C5.00008 5.67392 5.52686 4.40215 6.46454 3.46447Z" fill="currentColor"/>
            <path d="M9.17628 19.5182C8.9102 19.0343 8.30217 18.8577 7.8182 19.1237C7.33424 19.3898 7.15762 19.9979 7.4237 20.4818C7.67736 20.9432 8.05027 21.328 8.50346 21.596C8.95664 21.864 9.47348 22.0054 9.99999 22.0054C10.5265 22.0054 11.0433 21.864 11.4965 21.596C11.9497 21.328 12.3226 20.9432 12.5763 20.4818C12.8424 19.9979 12.6657 19.3898 12.1818 19.1237C11.6978 18.8577 11.0898 19.0343 10.8237 19.5182C10.7426 19.6658 10.6234 19.7888 10.4785 19.8745C10.3336 19.9602 10.1683 20.0054 9.99999 20.0054C9.83166 20.0054 9.66641 19.9602 9.52151 19.8745C9.37661 19.7888 9.25738 19.6658 9.17628 19.5182Z" fill="currentColor"/>
          </svg>
          <p className="text-md">Notifications</p>
        </button>
        <button className={`flex gap-x-2 p-2 rounded-lg hover:bg-hover-light dark:hover:bg-hover-dark transition-all ${
          location.pathname.includes("/notifications") ? "bg-foreground-light dark:bg-foreground-dark text-text-lightHighlight dark:text-text-darkHighlight" : "text-text-gray"
        }`}>
          <svg width="22" height="22" viewBox="0 0 22 22" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M11 7C8.79086 7 7 8.79086 7 11C7 13.2091 8.79086 15 11 15C13.2091 15 15 13.2091 15 11C15 8.79086 13.2091 7 11 7ZM9 11C9 9.89543 9.89543 9 11 9C12.1046 9 13 9.89543 13 11C13 12.1046 12.1046 13 11 13C9.89543 13 9 12.1046 9 11Z" fill="currentColor"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M10.78 0C9.98435 0 9.22129 0.31607 8.65868 0.87868C8.09608 1.44129 7.78 2.20435 7.78 3L7.78 3.17897C7.77974 3.35417 7.73345 3.52671 7.64577 3.67839C7.55801 3.83022 7.43187 3.95629 7.28 4.04397L7.27738 4.04549L6.85 4.29397L6.84894 4.29459C6.69718 4.38196 6.52513 4.42795 6.35 4.42795C6.17447 4.42795 6.00202 4.38174 5.85 4.29397C5.84029 4.28837 5.83049 4.28292 5.82059 4.27765L5.68379 4.20468C4.99871 3.81504 4.18754 3.71053 3.42568 3.91425C2.65793 4.11955 2.00301 4.62109 1.60468 5.30879L1.38379 5.69032C0.986686 6.37873 0.878957 7.19657 1.08425 7.96432C1.28656 8.7209 1.77655 9.3679 2.44887 9.76776L2.5753 9.85205C2.59317 9.86396 2.61142 9.8753 2.63002 9.88604C2.78116 9.97329 2.90683 10.0986 2.99455 10.2495C3.08184 10.3996 3.12852 10.5699 3.13 10.7435V11.25L3.13001 11.254C3.13071 11.4302 3.08484 11.6034 2.99703 11.7562C2.90923 11.909 2.78262 12.0359 2.63001 12.124L2.61551 12.1325L2.47148 12.2189C1.78754 12.6177 1.28882 13.2706 1.08425 14.0357C0.878957 14.8034 0.986686 15.6213 1.38379 16.3097L1.60468 16.6912C2.00301 17.3789 2.65793 17.8805 3.42568 18.0858C4.18753 18.2895 4.9987 18.185 5.68377 17.7953L5.82059 17.7224C5.83049 17.7171 5.84029 17.7116 5.85 17.706C6.00202 17.6183 6.17447 17.5721 6.35 17.5721C6.52513 17.5721 6.69718 17.618 6.84894 17.7054L6.85 17.706L7.27738 17.9545L7.28 17.956C7.43187 18.0437 7.55801 18.1698 7.64577 18.3216C7.73345 18.4733 7.77974 18.6453 7.78 18.8205V19C7.78 19.7957 8.09608 20.5587 8.65868 21.1213C9.22129 21.6839 9.98435 22 10.78 22H11.22C12.0157 22 12.7787 21.6839 13.3413 21.1213C13.9039 20.5587 14.22 19.7957 14.22 19L14.22 18.821C14.2203 18.646 14.2666 18.4732 14.3542 18.3216C14.442 18.1698 14.5681 18.0437 14.72 17.956L14.7215 17.9552L15.15 17.706L15.1511 17.7054C15.3028 17.618 15.4749 17.5721 15.65 17.5721C15.8255 17.5721 15.998 17.6183 16.15 17.706C16.1597 17.7116 16.1695 17.7171 16.1794 17.7224L16.3162 17.7953C17.0013 18.185 17.8125 18.2895 18.5743 18.0858C19.3421 17.8805 19.997 17.3789 20.3953 16.6912L20.401 16.6813L20.6188 16.2951C21.0138 15.6077 21.1206 14.7917 20.9158 14.0257C20.7105 13.2579 20.2089 12.603 19.5212 12.2047C19.5111 12.1988 19.5009 12.1931 19.4906 12.1876L19.358 12.1169C19.2107 12.0292 19.0885 11.905 19.003 11.7562C18.9152 11.6034 18.8693 11.4302 18.87 11.254L18.87 11.25V10.75L18.87 10.746C18.8693 10.5698 18.9152 10.3966 19.003 10.2438C19.0908 10.091 19.2174 9.96414 19.37 9.87603L19.3845 9.86749L19.5286 9.78105C20.2125 9.38232 20.7112 8.72933 20.9158 7.96432C21.121 7.19657 21.0133 6.37873 20.6162 5.69032L20.3953 5.30879C19.997 4.62109 19.3421 4.11955 18.5743 3.91425C17.8125 3.71053 17.0013 3.81504 16.3162 4.20468L16.1794 4.27765C16.1695 4.28292 16.1597 4.28837 16.15 4.29397C15.998 4.38174 15.8255 4.42795 15.65 4.42795C15.4749 4.42795 15.3028 4.38196 15.1511 4.29459L15.15 4.29397L14.7226 4.04549L14.72 4.04397C14.5681 3.95629 14.442 3.83022 14.3542 3.67839C14.2666 3.52681 14.2203 3.35489 14.22 3.17982V3C14.22 2.20435 13.9039 1.44129 13.3413 0.87868C12.7787 0.31607 12.0157 0 11.22 0H10.78ZM10.0729 2.29289C10.2604 2.10536 10.5148 2 10.78 2H11.22C11.4852 2 11.7396 2.10536 11.9271 2.29289C12.1146 2.48043 12.22 2.73478 12.22 3V3.18103C12.2205 3.70711 12.3594 4.22381 12.6227 4.67928C12.8857 5.13431 13.2637 5.51225 13.7187 5.77526L13.72 5.77603L14.1474 6.02451L14.15 6.02603C14.6061 6.28933 15.1234 6.42795 15.65 6.42795C16.1704 6.42795 16.6818 6.29256 17.1339 6.03524L17.2706 5.96235C17.2804 5.95713 17.2901 5.95175 17.2997 5.94621C17.5291 5.81384 17.8018 5.77793 18.0577 5.84637C18.3135 5.91478 18.5318 6.08189 18.6646 6.31104L18.8838 6.68968C19.016 6.91907 19.052 7.19188 18.9836 7.44768C18.9152 7.70359 18.748 7.9219 18.5188 8.05468L18.5055 8.06251L18.362 8.14862C17.9078 8.41273 17.5308 8.79155 17.2689 9.24721C17.0059 9.70485 16.8683 10.2238 16.87 10.7516V11.2484C16.8683 11.7762 17.0059 12.2951 17.2689 12.7528C17.5324 13.2111 17.9122 13.5917 18.37 13.856C18.3797 13.8616 18.3895 13.8671 18.3994 13.8724L18.5313 13.9427C18.7541 14.0761 18.9165 14.2911 18.9836 14.5423C19.0521 14.7982 19.0162 15.0709 18.8838 15.3003L18.879 15.3087L18.6623 15.6929C18.5293 15.92 18.3121 16.0856 18.0577 16.1536C17.8018 16.2221 17.5291 16.1862 17.2997 16.0538C17.2901 16.0482 17.2804 16.0429 17.2706 16.0376L17.1339 15.9648C16.6818 15.7074 16.1704 15.572 15.65 15.572C15.1234 15.572 14.6061 15.7107 14.15 15.974L14.1474 15.9755L13.72 16.224L13.7186 16.2248C13.2636 16.4878 12.8857 16.8657 12.6227 17.3207C12.3594 17.7762 12.2205 18.2929 12.22 18.819V19C12.22 19.2652 12.1146 19.5196 11.9271 19.7071C11.7396 19.8946 11.4852 20 11.22 20H10.78C10.5148 20 10.2604 19.8946 10.0729 19.7071C9.88536 19.5196 9.78 19.2652 9.78 19L9.78 18.819C9.77946 18.2929 9.64059 17.7762 9.37731 17.3207C9.11433 16.8658 8.73645 16.4879 8.28152 16.2249L8.28 16.224L7.85129 15.9747L7.85 15.974C7.39395 15.7107 6.87662 15.572 6.35 15.572C5.82957 15.572 5.3182 15.7074 4.86608 15.9648L4.72942 16.0376C4.71963 16.0429 4.70993 16.0482 4.70033 16.0538C4.47086 16.1862 4.19825 16.2221 3.94233 16.1536C3.68648 16.0852 3.46822 15.9181 3.33543 15.689L3.11622 15.3103C2.98414 15.081 2.948 14.808 3.01637 14.5523C3.0848 14.2964 3.25198 14.0781 3.48122 13.9453L3.4945 13.9375L3.63799 13.8514C4.09223 13.5873 4.46919 13.2085 4.73106 12.7528C4.99411 12.2951 5.13171 11.7761 5.13 11.2482V10.74L5.12999 10.734C5.12683 10.2104 4.98671 9.69682 4.72356 9.24421C4.46636 8.80182 4.10038 8.43275 3.6606 8.17188L3.53471 8.08795C3.51723 8.0763 3.49939 8.0652 3.48122 8.05468C3.25198 7.9219 3.0848 7.70359 3.01637 7.44768C2.948 7.19197 2.98379 6.91959 3.11589 6.69024L3.33533 6.31121C3.46811 6.08207 3.68648 5.91478 3.94233 5.84637C4.19825 5.77793 4.47086 5.81384 4.70033 5.94621C4.70993 5.95175 4.71963 5.95713 4.72942 5.96235L4.86607 6.03524C5.3182 6.29256 5.82957 6.42795 6.35 6.42795C6.87661 6.42795 7.39395 6.28933 7.85 6.02603L7.85263 6.02451L8.28 5.77603L8.28143 5.7752C8.7364 5.51219 9.11431 5.13428 9.37731 4.67928C9.64059 4.22381 9.77946 3.70711 9.78 3.18103L9.78 3C9.78 2.73478 9.88536 2.48043 10.0729 2.29289Z" fill="currentColor"/>
          </svg>

          <p className="text-md">Settings</p>
        </button>

        <WorkspaceMenu />
      </div>
    </div>
  );
}